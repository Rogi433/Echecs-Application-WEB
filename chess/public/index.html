<!DOCTYPE html>

<html lang="fr">
<meta charset="utf-8">

<title>Choix de la partie d'échecs</title>

<style>

#page_accueil div{
	text-align : center;
	padding-bottom : 3vh;
}

td {
	padding : 0.25vw;
	background-repeat: no-repeat;
	background-position: center;
	background-size: 2.5vw;
}

td:hover {
	border: 0.25vw solid red;
	padding:0;
}

img{
	padding-left : 1vw;
}

#echiquier{
	border : solid black;
	margin : 0 5vw;
}

#promotion{
padding-top:1vw;
margin : 0 5vw;
width : 30vw;
text-align:center;
}

#chat{
	width : 40vw;
	text-align:center;
	border : solid black;
}

#chatContent{
	height : 22.5vw;
	overflow : auto;
	
}

#inputZone{
	padding-bottom: 1vw;
	
}

.message{
	width : 10vw;
	font-size: 1.5vw;
}
</style>


<body>

<div id="page_accueil">

<h1>Liste des parties d'échecs</h1>
<div id="liste_parties"></div>

<div><label for="nomPartie">Nom de la partie à créer :</label>
  <input type="text" id="nomPartie" name="nomPartie"> <button id="boutonCreer">Créer la partie</button> </div>

</div>


<div id="page_jeu" style="display : none;">

<h1>Jeu d'échecs</h1>
<div id="contenu">
<p>Vous etes le joueur <span id="indication_joueur"></span> 
<br/> <span id="info_tour"></span></p>
<table id="echiquier" style="float:left"></table>

<div id="chat" style="float:left">Chat :<br/><hr style="height : 0.1vw; background : black"/> <div id="chatContent"></div><br/><hr style="height : 0.1vw; background : black"/>
<div id="inputZone"><label class="message" for="messageText">Message à envoyer :</label>
  <input class="message" type="text" id="messageText" name="messageText"> <button class="message" id="boutonEnvoi">Envoyer</button> </div>
  </div>
  
 <div id="promotion" style="clear:left">Promotion :<br/><hr/></div></div>
 
 
 <div id="infoPartie" style="clear:left"></div>

</div>

</body>

<script src="/socket.io/socket.io.js"></script>
  
<script>

var socket = io();

socket.on('listeParties',function(noms){
	liste_noms=JSON.parse(noms);
	
	for (let k=0; k<liste_noms.length; k++) addPartie(k,liste_noms[k]); // ajout de toutes les parties deja existantes dans la liste
	
});

nomPartie.addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
        boutonCreer.click();
    }
});

boutonCreer.addEventListener('click',function(){
	let nom=nomPartie.value;
	if (nom!=""){
		nomPartie.value="";
		socket.emit('createGame',nom,addPartie);
	}
});


function join(id,joueur){

	this.disabled="true";
	
	socket.emit('joinGame',id,joueur);
	
	//window.location.replace("game.html");
	page_accueil.style.display="none";
	page_jeu.style.display="block";
	
	
	
}

function addPartie(id,name){

	let div = document.createElement("div");
	let bouton1 = document.createElement("button");
	bouton1.textContent="Rejoindre en tant que blanc";
	bouton1.addEventListener('click', function(){join(id,1)});
	
	let bouton2 = document.createElement("button");
	bouton2.textContent="Rejoindre en tant que noir";
	bouton2.addEventListener('click', function(){join(id,-1)});
	
	let texte=document.createTextNode(" - "+name+" - ");
	
	div.appendChild(bouton1);
	div.appendChild(texte);
	div.appendChild(bouton2);
	
	liste_parties.appendChild(div);
}


</script>

<script src="script_chess.js"></script>
